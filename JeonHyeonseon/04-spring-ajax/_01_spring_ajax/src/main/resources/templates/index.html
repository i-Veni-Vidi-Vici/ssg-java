<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spring Ajax</title>
</head>
<body>
    <h1>Spring Ajax</h1>
    <!--
        AJAXëŠ” ëŒ€í™”í˜• ì›¹ ì‘ìš©í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ê¸° ìœ„í•œ ì›¹ ê°œë°œ ê¸°ìˆ ì´ë‹¤.
        Asynchronous Javascript And XML (ë¹„ë™ê¸°ì  ìë°”ìŠ¤í¬ë¦½íŠ¸ì™€ xml)
        ê¸°ì¡´ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë™ê¸° ìš”ì²­ì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¡œë¶€í„° ì •ë³´ë¥¼ ì „ì†¡í•œë‹¤.
        form ì–‘ì‹ì„ ì‘ì„±í•˜ê³  ì œì¶œí•˜ë©´ ì„œë²„ì˜ ìƒˆ ì •ë³´ê°€ ìˆëŠ” ìƒˆ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.
        í•˜ì§€ë§Œ AJAXë¥¼ ì‚¬ìš©í•˜ë©´ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì„œë²„ì— ìš”ì²­í•˜ì—¬ ë°›ì€ ê²°ê³¼ë¥¼ í•´ì„í•˜ê³ , í˜„ì¬ í™”ë©´ì„ ì—…ë°ì´íŠ¸ í•œë‹¤.
        ë”°ë¼ì„œ í´ë¼ì´ì–¸íŠ¸ëŠ” í™”ë©´ ê°±ì‹  ì—†ì´ (ë°ì´í„°ê°€ ì„œë²„ë¡œ ì „ì†¡ë˜ì—ˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œì§€ ëª»í•´ë„) ì„œë²„ ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆë‹¤.
        AJAXëŠ” ì„œë²„ ì†Œí”„íŠ¸ì›¨ì–´ì™€ëŠ” ë³„ê°œì˜ ë…ë¦½ì ì¸ ì›¹ ë¸Œë¼ìš°ì € ê¸°ìˆ ì´ë©°, ê¸°ìˆ  ìì²´ë¡œëŠ” front-endë¡œ ë¶„ë¥˜ëœë‹¤.
        í•˜ì§€ë§Œ ì„œë²„ ì „ì†¡ ì´í›„ back-endì™€ ì—°ë™ë˜ë¯€ë¡œ, back-endì™€ í˜¼ë™í•  ìˆ˜ ìˆë‹¤.
        ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì„œë²„ì™€ ë¹„ë™ê¸° ìƒí˜¸ ì‘ìš©ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ XMLHttpRequest ê°ì²´ë¥¼ ì´ìš©í•œë‹¤.

        AJAXì˜ ì¥ë‹¨ì 
        ì¥ì 
        1. ì›¹ í˜ì´ì§€ì˜ ì†ë„ í–¥ìƒ (ì „ì²´ í˜ì´ì§€ë¥¼ ê°±ì‹ í•˜ì§€ ì•Šê³ , í•„ìš”í•œ ë°ì´í„°ë§Œ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ë™ê¸° ë°©ì‹ë³´ë‹¤ ì†ë„ê°€ ë¹ ë¥´ë‹¤.)
        2. ì„œë²„ì—ì„œ ë°ì´í„°ë§Œ ì „ì†¡í•˜ë©´ ë˜ë¯€ë¡œ ì‘ë‹µì— ëŒ€í•œ ì½”ë“œ ì‘ì„± ì–‘ì´ ì¤„ì–´ë“ ë‹¤.
        3. ê¸°ì¡´ ì›¹ì—ì„œ ë¶ˆê°€ëŠ¥í–ˆë˜ ë‹¤ì–‘í•œ ê¸°ëŠ¥(ë¬´í•œ ìŠ¤í¬ë¡¤, ì‹¤ì‹œê°„ ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ ë“±)ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.

        ë‹¨ì 
        1. í˜ì´ì§€ ì´ë™ì´ ì—†ëŠ” í†µì‹ ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ë³´ì•ˆìƒ ë¬¸ì œê°€ ìˆë‹¤.
        2. ì—°ì†ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ë©´ ì„œë²„ ë¶€í•˜ë¥¼ ê°€ì¤‘ì‹œí‚¬ ìˆ˜ ìˆë‹¤.
        3. AJAXë¥¼ ì“¸ ìˆ˜ ì—†ëŠ” ë¸Œë¼ìš°ì €ì— ëŒ€í•œ ì´ìŠˆê°€ ìˆë‹¤.
        4. scriptë¡œ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— ë””ë²„ê¹…ì´ ìš©ì´í•˜ì§€ ì•Šë‹¤.
     -->
    <button id="btn1">XMLHttpRequest ì§ì ‘ ì‚¬ìš©</button>
    <button id="btn2">jQuery.ajax - GET</button>
    <button id="btn3">jQuery.ajax - POST</button>
    <img th:src="@{images/gif-animations-replace-loading-screen-14.gif}" id="loading" alt="">

    <!-- jQuery ë¡œë“œ -->
    <!-- 1. ìš°ë¦¬ ì„œë²„ì—ì„œ ë‹¤ìš´ë¡œë“œ ë°›ì€ jquery.jsë¥¼ ì§ì ‘ ì œê³µ -->
<!--    <script th:src="@{/js/jquery-3.7.1.js}"></script>-->
    <!-- 2. CDN(Content Delivery Network)ë°©ì‹ìœ¼ë¡œ ì œê³µ -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"
            integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
            crossorigin="anonymous"></script>

    <script>
        console.log($);
        $(() => {
           // jquery onload ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
           console.log('jQuery load completeğŸ§€');
           $("h1").css('color', 'blue');

        });

        /**
         * jQuery
         * - DOMì œì–´, ë„¤íŠ¸ì›Œí‚¹ ê´€ë ¨í•´ì„œ í¸ì˜ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” jsë¼ì´ë¸ŒëŸ¬ë¦¬
         *
         * jQuery.ajax
         * - ê¸°ì¡´ XMLHttpRequestë¥¼ ê°„ê²°í•˜ê²Œ ì‚¬ìš©ê°€ëŠ¥
         * - IE í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì— ëŒ€í•œ ë¹„ë™ê¸° ìš”ì²­ ì²˜ë¦¬ë„ ëŒ€ì‹  í•´ì¤€ë‹¤.
         */
        document.querySelector("#btn2").onclick = () => {
            $.ajax({
                url : '[[@{/first}]]',
                method: 'get',
                data : {
                    // getë°©ì‹ì—ì„œëŠ” urlë’¤ì— queryStringí˜•íƒœë¡œ ì¶”ê°€í•œë‹¤.
                    username: 'sinsa',
                },
                success (responseText, textStatus, jqXhr) {
                    // ì •ìƒ ì²˜ë¦¬
                    console.log(responseText, textStatus, jqXhr);
                    alert(responseText);
                },
                error (jqXhr, textStatus, error) {
                    // ì˜¤ë¥˜ ë°œìƒì‹œ í˜¸ì¶œ
                    console.log(jqXhr, textStatus, error);
                }
            })
        }

        document.querySelector("#btn3").onclick = () => {
            $.ajax({
                url : '[[@{/first}]]',
                method: 'post',
                data : {
                    // postë°©ì‹ì—ì„œëŠ” ë©”ì‹œì§€ ë³¸ë¶„(body)ì— queryStringí˜•íƒœë¡œ ì¶”ê°€í•œë‹¤.
                    username: 'sinsa',
                },
                beforeSend(){
                    // ìš”ì²­ ì „ ì‘ì—…
                    console.log('beforeSend')
                    $("#loading").show();
                },
                success (responseText, textStatus, jqXhr) {
                    // ì •ìƒ ì²˜ë¦¬
                    console.log('success')
                    console.log(responseText, textStatus, jqXhr);
                    alert(responseText);
                },
                error (jqXhr, textStatus, error) {
                    // ì˜¤ë¥˜ ë°œìƒì‹œ í˜¸ì¶œ
                    console.log('error')
                    console.log(jqXhr, textStatus, error);
                },
                complete(){
                    // ì‘ë‹µì™„ë£Œ(ì •ìƒì²˜ë¦¬/ë¹„ì •ìƒì²˜ë¦¬) í›„ ì‘ì—…
                    console.log('complete')
                    $("#loading").hide();
                }
            })
        }

        document.querySelector("#btn1").onclick = () => {
          const xmlHttpRequest = new XMLHttpRequest();
          // readystatechangeì— ëŒ€í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì‘ì„±
          xmlHttpRequest.onreadystatechange = (e) => {
              // 0 : ê°ì²´ìƒì„±
              // 1 : ì„œë²„ì™€ ì—°ê²°ì„±ê³µ
              // 2 : ì„œë²„ì— request ì „ì†¡
              // 3 : ì‘ë‹µ ì²˜ë¦¬ ì‹œì‘
              // 4 : ì‘ë‹µ ì²˜ë¦¬ ì™„ë£Œ
              if(xmlHttpRequest.readyState == XMLHttpRequest.DONE) {
                  if (xmlHttpRequest.status == 200) {
                      // ì •ìƒì²˜ë¦¬ëœ ê²½ìš°
                      alert(xmlHttpRequest.responseText);
                  } else {
                      // ì˜¤ë¥˜ ë˜ëŠ” ë¹„ì •ìƒì²˜ë¦¬ëœ ê²½ìš°
                      alert("Ajax ì²˜ë¦¬ ì‹¤íŒ¨")
                  }
              }
          };

          // ìš”ì²­ì„ ë³´ë‚¼ ë•ŒëŠ” ì—°ê²°ì‘ì—…
          xmlHttpRequest.open('GET', '[[@{/first}]]?username=honngd')
          // ì „ì†¡
          xmlHttpRequest.send()
        };
    </script>
</body>
</html>